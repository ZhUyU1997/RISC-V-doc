<table border="0" height="1453" width="1123">
<tr><td>
<div style="position:absolute; top:0; left:0;"><img height="1453" width="1123"src="bgimg/bg00045.jpg"/></div>
<div style="position:absolute;top:74.119;left:132.145;"><nobr>
<span style="font-size:20.022;font-style:italic;">Volume II: RISC-V Privileged Architectures V20190608-Priv-MSU-Ratified</span>
</nobr></div>
<div style="position:absolute;top:74.119;left:971.067;"><nobr>
<span style="font-size:20.022;">33</span>
</nobr></div>
<div style="position:absolute;top:124.355;left:216.237;"><nobr>
<span style="font-size:20.022;"># New comparand is in a1:a0.</span>
</nobr></div>
<div style="position:absolute;top:149.224;left:216.237;"><nobr>
<span style="font-size:20.022;">li t0, -1</span>
</nobr></div>
<div style="position:absolute;top:174.091;left:216.237;"><nobr>
<span style="font-size:20.022;">sw t0, mtimecmp # No smaller than old value.</span>
</nobr></div>
<div style="position:absolute;top:198.959;left:216.237;"><nobr>
<span style="font-size:20.022;">sw a1, mtimecmp+4 # No smaller than new value.</span>
</nobr></div>
<div style="position:absolute;top:223.826;left:216.237;"><nobr>
<span style="font-size:20.022;">sw a0, mtimecmp # New value.</span>
</nobr></div>
<div style="position:absolute;top:287.258;left:132.145;"><nobr>
<span style="font-size:20.022;">Figure 3.15: Sample code for setting the 64-bit time comparand in RV32 assuming the registers</span>
</nobr></div>
<div style="position:absolute;top:312.125;left:132.145;"><nobr>
<span style="font-size:20.022;">live in a strongly ordered I/O region.</span>
</nobr></div>
<div style="position:absolute;top:380.248;left:132.145;"><nobr>
<span style="font-size:21.942;font-weight:bold;">3.1.11</span>
</nobr></div>
<div style="position:absolute;top:380.248;left:219.847;"><nobr>
<span style="font-size:21.942;font-weight:bold;">Hardware Performance Monitor</span>
</nobr></div>
<div style="position:absolute;top:441.327;left:132.145;"><nobr>
<span style="font-size:20.022;">M-mode includes a basic hardware performance-monitoring facility. The mcycle CSR counts the</span>
</nobr></div>
<div style="position:absolute;top:466.194;left:132.145;"><nobr>
<span style="font-size:20.022;">number of clock cycles executed by the processor core on which the hart is running. The minstret</span>
</nobr></div>
<div style="position:absolute;top:491.061;left:132.145;"><nobr>
<span style="font-size:20.022;">CSR counts the number of instructions the hart has retired. The mcycle and minstret registers</span>
</nobr></div>
<div style="position:absolute;top:515.928;left:132.145;"><nobr>
<span style="font-size:20.022;">have 64-bit precision on all RV32 and RV64 systems.</span>
</nobr></div>
<div style="position:absolute;top:559.081;left:132.145;"><nobr>
<span style="font-size:20.022;">The counter registers have an arbitrary value after system reset, and can be written with a given</span>
</nobr></div>
<div style="position:absolute;top:583.948;left:132.145;"><nobr>
<span style="font-size:20.022;">value. Any CSR write takes effect after the writing instruction has otherwise completed.</span>
</nobr></div>
<div style="position:absolute;top:627.101;left:132.145;"><nobr>
<span style="font-size:20.022;">The hardware performance monitor includes 29 additional 64-bit event counters, mhpmcounter3 –</span>
</nobr></div>
<div style="position:absolute;top:653.630;left:132.145;"><nobr>
<span style="font-size:20.022;">mhpmcounter31 . The event selector CSRs, mhpmevent3 – mhpmevent31 , are MXLEN-bit</span>
<span style="font-size:20.022;font-weight:bold;">WARL</span>
</nobr></div>
<div style="position:absolute;top:676.835;left:132.145;"><nobr>
<span style="font-size:20.022;">registers that control which event causes the corresponding counter to increment. The meaning</span>
</nobr></div>
<div style="position:absolute;top:701.704;left:132.145;"><nobr>
<span style="font-size:20.022;">of these events is defined by the platform, but event 0 is defined to mean “no event.” All coun-</span>
</nobr></div>
<div style="position:absolute;top:726.571;left:132.145;"><nobr>
<span style="font-size:20.022;">ters should be implemented, but a legal implementation is to hard-wire both the counter and its</span>
</nobr></div>
<div style="position:absolute;top:751.439;left:132.145;"><nobr>
<span style="font-size:20.022;">corresponding event selector to 0.</span>
</nobr></div>
<div style="position:absolute;top:802.863;left:157.405;"><nobr>
<span style="font-size:14.628;">63</span>
</nobr></div>
<div style="position:absolute;top:802.863;left:524.566;"><nobr>
<span style="font-size:14.628;">0</span>
</nobr></div>
<div style="position:absolute;top:823.073;left:316.137;"><nobr>
<span style="font-size:16.456;">mcycle</span>
</nobr></div>
<div style="position:absolute;top:843.187;left:307.498;"><nobr>
<span style="font-size:16.456;">minstret</span>
</nobr></div>
<div style="position:absolute;top:863.203;left:585.556;"><nobr>
<span style="font-size:14.628;">MXLEN-1</span>
</nobr></div>
<div style="position:absolute;top:863.203;left:952.658;"><nobr>
<span style="font-size:14.628;">0</span>
</nobr></div>
<div style="position:absolute;top:883.414;left:290.218;"><nobr>
<span style="font-size:16.456;">mhpmcounter3</span>
</nobr></div>
<div style="position:absolute;top:903.527;left:290.218;"><nobr>
<span style="font-size:16.456;">mhpmcounter4</span>
</nobr></div>
<div style="position:absolute;top:928.258;left:339.707;"><nobr>
<span style="font-size:16.456;">. .</span>
</nobr></div>
<div style="position:absolute;top:957.052;left:285.900;"><nobr>
<span style="font-size:16.456;">mhpmcounter30</span>
</nobr></div>
<div style="position:absolute;top:977.165;left:285.900;"><nobr>
<span style="font-size:16.456;">mhpmcounter31</span>
</nobr></div>
<div style="position:absolute;top:995.911;left:333.599;"><nobr>
<span style="font-size:16.456;">64</span>
</nobr></div>
<div style="position:absolute;top:883.414;left:732.496;"><nobr>
<span style="font-size:16.456;">mhpmevent3</span>
</nobr></div>
<div style="position:absolute;top:903.527;left:732.496;"><nobr>
<span style="font-size:16.456;">mhpmevent4</span>
</nobr></div>
<div style="position:absolute;top:928.258;left:773.343;"><nobr>
<span style="font-size:16.456;">. .</span>
</nobr></div>
<div style="position:absolute;top:957.052;left:728.175;"><nobr>
<span style="font-size:16.456;">mhpmevent30</span>
</nobr></div>
<div style="position:absolute;top:977.165;left:728.175;"><nobr>
<span style="font-size:16.456;">mhpmevent31</span>
</nobr></div>
<div style="position:absolute;top:995.911;left:738.708;"><nobr>
<span style="font-size:16.456;">MXLEN</span>
</nobr></div>
<div style="position:absolute;top:1042.217;left:324.857;"><nobr>
<span style="font-size:20.022;">Figure 3.16: Hardware performance monitor counters.</span>
</nobr></div>
<div style="position:absolute;top:1096.791;left:132.145;"><nobr>
<span style="font-size:20.022;">The mhpmcounter s are</span>
<span style="font-size:20.022;font-weight:bold;">WARL</span>
<span style="font-size:20.022;">registers that support up to 64 bits of precision on RV32 and RV64.</span>
</nobr></div>
<div style="position:absolute;top:1175.096;left:182.201;"><nobr>
<span style="font-size:18.285;font-style:italic;">A future revision of this specification will define a mechanism to generate an interrupt when a</span>
</nobr></div>
<div style="position:absolute;top:1197.037;left:182.201;"><nobr>
<span style="font-size:18.285;font-style:italic;">hardware performance monitor counter overflows.</span>
</nobr></div>
<div style="position:absolute;top:1250.030;left:132.145;"><nobr>
<span style="font-size:20.022;">On RV32 only, reads of the mcycle , minstret , and mhpmcounter</span>
<span style="font-size:20.022;font-style:italic;">n</span>
<span style="font-size:20.022;">CSRs return the low 32 bits, while</span>
</nobr></div>
<div style="position:absolute;top:1274.899;left:132.145;"><nobr>
<span style="font-size:20.022;">reads of the mcycleh , minstreth , and mhpmcounter</span>
<span style="font-size:20.022;font-style:italic;">n</span>
<span style="font-size:20.022;">h CSRs return bits 63–32 of the corresponding</span>
</nobr></div>
<div style="position:absolute;top:1299.766;left:132.145;"><nobr>
<span style="font-size:20.022;">counter.</span>
</nobr></div>
</td></tr>
</table>
