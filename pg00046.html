<table border="0" height="1453" width="1123">
<tr><td>
<div style="position:absolute; top:0; left:0;"><img height="1453" width="1123"src="bgimg/bg00046.jpg"/></div>
<div style="position:absolute;top:74.119;left:132.145;"><nobr>
<span style="font-size:20.022;">34</span>
</nobr></div>
<div style="position:absolute;top:74.119;left:331.141;"><nobr>
<span style="font-size:20.022;font-style:italic;">Volume II: RISC-V Privileged Architectures V20190608-Priv-MSU-Ratified</span>
</nobr></div>
<div style="position:absolute;top:128.281;left:371.480;"><nobr>
<span style="font-size:14.628;">31</span>
</nobr></div>
<div style="position:absolute;top:128.281;left:738.641;"><nobr>
<span style="font-size:14.628;">0</span>
</nobr></div>
<div style="position:absolute;top:416.122;left:132.145;"><nobr>
<span style="font-size:21.942;font-weight:bold;">3.1.12</span>
</nobr></div>
<div style="position:absolute;top:149.222;left:531.378;"><nobr>
<span style="font-size:16.456;">mcycleh</span>
</nobr></div>
<div style="position:absolute;top:170.068;left:522.739;"><nobr>
<span style="font-size:16.456;">minstreth</span>
</nobr></div>
<div style="position:absolute;top:190.912;left:505.461;"><nobr>
<span style="font-size:16.456;">mhpmcounter3h</span>
</nobr></div>
<div style="position:absolute;top:211.758;left:505.461;"><nobr>
<span style="font-size:16.456;">mhpmcounter4h</span>
</nobr></div>
<div style="position:absolute;top:229.906;left:559.268;"><nobr>
<span style="font-size:16.456;">..</span>
</nobr></div>
<div style="position:absolute;top:244.533;left:559.268;"><nobr>
<span style="font-size:16.456;">.</span>
</nobr></div>
<div style="position:absolute;top:266.743;left:501.141;"><nobr>
<span style="font-size:16.456;">mhpmcounter30h</span>
</nobr></div>
<div style="position:absolute;top:287.589;left:501.141;"><nobr>
<span style="font-size:16.456;">mhpmcounter31h</span>
</nobr></div>
<div style="position:absolute;top:307.067;left:547.676;"><nobr>
<span style="font-size:16.456;">32</span>
</nobr></div>
<div style="position:absolute;top:353.371;left:200.886;"><nobr>
<span style="font-size:20.022;">Figure 3.17: Upper 32 bits of hardware performance monitor counters, RV32 only.</span>
</nobr></div>
<div style="position:absolute;top:416.122;left:219.847;"><nobr>
<span style="font-size:21.942;font-weight:bold;">Counter-Enable Registers (</span>
<span style="font-size:21.942;">[m|s]counteren</span>
<span style="font-size:21.942;font-weight:bold;">)</span>
</nobr></div>
<div style="position:absolute;top:475.189;left:132.145;"><nobr>
<span style="font-size:20.022;">The counter-enable registers mcounteren and scounteren are 32-bit registers that control the</span>
</nobr></div>
<div style="position:absolute;top:500.058;left:132.145;"><nobr>
<span style="font-size:20.022;">availability of the hardware performance-monitoring counters to the next-lowest privileged mode.</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:175.320;"><nobr>
<span style="font-size:14.628;">31</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:247.640;"><nobr>
<span style="font-size:14.628;">30</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:319.595;"><nobr>
<span style="font-size:14.628;">29</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:376.293;"><nobr>
<span style="font-size:14.628;">28</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:653.595;"><nobr>
<span style="font-size:14.628;">6</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:696.542;"><nobr>
<span style="font-size:14.628;">5</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:760.057;"><nobr>
<span style="font-size:14.628;">4</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:823.556;"><nobr>
<span style="font-size:14.628;">3</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:872.267;"><nobr>
<span style="font-size:14.628;">2</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:910.754;"><nobr>
<span style="font-size:14.628;">1</span>
</nobr></div>
<div style="position:absolute;top:547.220;left:952.414;"><nobr>
<span style="font-size:14.628;">0</span>
</nobr></div>
<div style="position:absolute;top:566.795;left:154.788;"><nobr>
<span style="font-size:16.456;">HPM31 HPM30 HPM29</span>
</nobr></div>
<div style="position:absolute;top:587.641;left:178.862;"><nobr>
<span style="font-size:16.456;">1 1 1</span>
</nobr></div>
<div style="position:absolute;top:566.795;left:508.632;"><nobr>
<span style="font-size:16.456;">...</span>
</nobr></div>
<div style="position:absolute;top:587.641;left:507.548;"><nobr>
<span style="font-size:16.456;">23</span>
</nobr></div>
<div style="position:absolute;top:566.795;left:676.033;"><nobr>
<span style="font-size:16.456;">HPM5 HPM4 HPM3 IR TM CY</span>
</nobr></div>
<div style="position:absolute;top:587.641;left:696.172;"><nobr>
<span style="font-size:16.456;">1 1 1 1 1 1</span>
</nobr></div>
<div style="position:absolute;top:635.057;left:257.033;"><nobr>
<span style="font-size:20.022;">Figure 3.18: Counter-enable registers ( mcounteren and scounteren ).</span>
</nobr></div>
<div style="position:absolute;top:686.484;left:132.145;"><nobr>
<span style="font-size:20.022;">The settings in these registers only control accessibility. The act of reading or writing these registers</span>
</nobr></div>
<div style="position:absolute;top:711.352;left:132.145;"><nobr>
<span style="font-size:20.022;">does not affect the underlying counters, which continue to increment even when not accessible.</span>
</nobr></div>
<div style="position:absolute;top:754.503;left:132.145;"><nobr>
<span style="font-size:20.022;">When the CY, TM, IR, or HPM</span>
<span style="font-size:20.022;font-style:italic;">n</span>
<span style="font-size:20.022;">bit in the mcounteren register is clear, attempts to read the</span>
</nobr></div>
<div style="position:absolute;top:781.034;left:132.145;"><nobr>
<span style="font-size:20.022;">cycle , time , instret , or hpmcounter</span>
<span style="font-size:20.022;font-style:italic;">n</span>
<span style="font-size:20.022;">register while executing in S-mode or U-mode will cause</span>
</nobr></div>
<div style="position:absolute;top:804.240;left:132.145;"><nobr>
<span style="font-size:20.022;">an illegal instruction exception. When one of these bits is set, access to the corresponding register</span>
</nobr></div>
<div style="position:absolute;top:829.107;left:132.145;"><nobr>
<span style="font-size:20.022;">is permitted in the next implemented privilege mode (S-mode if implemented, otherwise U-mode).</span>
</nobr></div>
<div style="position:absolute;top:872.260;left:132.145;"><nobr>
<span style="font-size:20.022;">If S-mode is implemented, the same bit positions in the scounteren register analogously control</span>
</nobr></div>
<div style="position:absolute;top:897.127;left:132.145;"><nobr>
<span style="font-size:20.022;">access to these registers while executing in U-mode. If S-mode is permitted to access a counter</span>
</nobr></div>
<div style="position:absolute;top:921.994;left:132.145;"><nobr>
<span style="font-size:20.022;">register and the corresponding bit is set in scounteren , then U-mode is also permitted to access</span>
</nobr></div>
<div style="position:absolute;top:946.861;left:132.145;"><nobr>
<span style="font-size:20.022;">that register.</span>
</nobr></div>
<div style="position:absolute;top:990.014;left:132.145;"><nobr>
<span style="font-size:20.022;">Registers mcounteren and scounteren are</span>
<span style="font-size:20.022;font-weight:bold;">WARL</span>
<span style="font-size:20.022;">registers that must be implemented if U-mode</span>
</nobr></div>
<div style="position:absolute;top:1014.881;left:132.145;"><nobr>
<span style="font-size:20.022;">and S-mode are implemented. Any of the bits may contain a hardwired value of zero, indicating</span>
</nobr></div>
<div style="position:absolute;top:1039.750;left:132.145;"><nobr>
<span style="font-size:20.022;">reads to the corresponding counter will cause an illegal instruction exception when executing in a</span>
</nobr></div>
<div style="position:absolute;top:1064.617;left:132.145;"><nobr>
<span style="font-size:20.022;">less-privileged mode.</span>
</nobr></div>
<div style="position:absolute;top:1125.029;left:182.201;"><nobr>
<span style="font-size:18.285;font-style:italic;">The counter-enable bits support two common use cases with minimal hardware. For systems that</span>
</nobr></div>
<div style="position:absolute;top:1146.971;left:182.201;"><nobr>
<span style="font-size:18.285;font-style:italic;">do not need high-performance timers and counters, machine-mode software can trap accesses and</span>
</nobr></div>
<div style="position:absolute;top:1168.914;left:182.201;"><nobr>
<span style="font-size:18.285;font-style:italic;">implement all features in software. For systems that need high-performance timers and counters</span>
</nobr></div>
<div style="position:absolute;top:1190.856;left:182.201;"><nobr>
<span style="font-size:18.285;font-style:italic;">but are not concerned with obfuscating the underlying hardware counters, the counters can be</span>
</nobr></div>
<div style="position:absolute;top:1212.797;left:182.201;"><nobr>
<span style="font-size:18.285;font-style:italic;">directly exposed to lower privilege modes.</span>
</nobr></div>
<div style="position:absolute;top:1250.030;left:132.145;"><nobr>
<span style="font-size:20.022;">The cycle , instret , and hpmcounter</span>
<span style="font-size:20.022;font-style:italic;">n</span>
<span style="font-size:20.022;">CSRs are read-only shadows of mcycle , minstret , and</span>
</nobr></div>
<div style="position:absolute;top:1276.560;left:132.145;"><nobr>
<span style="font-size:20.022;">mhpmcounter</span>
<span style="font-size:20.022;font-style:italic;">n</span>
<span style="font-size:20.022;">, respectively. The time CSR is a read-only shadow of the memory-mapped mtime</span>
</nobr></div>
<div style="position:absolute;top:1299.766;left:132.145;"><nobr>
<span style="font-size:20.022;">register.</span>
</nobr></div>
</td></tr>
</table>
