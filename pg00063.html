<table border="0" height="1453" width="1123">
<tr><td>
<div style="position:absolute; top:0; left:0;"><img height="1453" width="1123"src="bgimg/bg00063.jpg"/></div>
<div style="position:absolute;top:74.119;left:132.145;"><nobr>
<span style="font-size:20.022;font-style:italic;">Volume II: RISC-V Privileged Architectures V20190608-Priv-MSU-Ratified</span>
</nobr></div>
<div style="position:absolute;top:74.119;left:971.067;"><nobr>
<span style="font-size:20.022;">51</span>
</nobr></div>
<div style="position:absolute;top:130.572;left:132.145;"><nobr>
<span style="font-size:20.022;">NAPOT ranges make use of the low-order bits of the associated address register to encode the size</span>
</nobr></div>
<div style="position:absolute;top:155.440;left:132.145;"><nobr>
<span style="font-size:20.022;">of the range, as shown in Table</span>
<span style="font-size:20.022;color: #000080;"><a href="#" onClick="javascript:parent.GotoNewPage(62); return false">3.10</a></span>
<span style="font-size:20.022;">.</span>
</nobr></div>
<div style="position:absolute;top:199.696;left:329.928;"><nobr>
<span style="font-size:20.022;">pmpaddr</span>
</nobr></div>
<div style="position:absolute;top:225.294;left:308.906;"><nobr>
<span style="font-size:20.022;">yyyy...yyyy</span>
</nobr></div>
<div style="position:absolute;top:250.161;left:308.906;"><nobr>
<span style="font-size:20.022;">yyyy...yyy0</span>
</nobr></div>
<div style="position:absolute;top:275.030;left:308.906;"><nobr>
<span style="font-size:20.022;">yyyy...yy01</span>
</nobr></div>
<div style="position:absolute;top:299.897;left:308.906;"><nobr>
<span style="font-size:20.022;">yyyy...y011</span>
</nobr></div>
<div style="position:absolute;top:323.103;left:353.371;"><nobr>
<span style="font-size:20.022;">...</span>
</nobr></div>
<div style="position:absolute;top:349.632;left:308.906;"><nobr>
<span style="font-size:20.022;">yy01...1111</span>
</nobr></div>
<div style="position:absolute;top:374.499;left:308.906;"><nobr>
<span style="font-size:20.022;">y011...1111</span>
</nobr></div>
<div style="position:absolute;top:399.368;left:308.906;"><nobr>
<span style="font-size:20.022;">0111...1111</span>
</nobr></div>
<div style="position:absolute;top:424.235;left:308.906;"><nobr>
<span style="font-size:20.022;">1111...1111</span>
</nobr></div>
<div style="position:absolute;top:199.696;left:447.205;"><nobr>
<span style="font-size:20.022;">pmpcfg .A</span>
</nobr></div>
<div style="position:absolute;top:223.632;left:469.005;"><nobr>
<span style="font-size:20.022;">NA4</span>
</nobr></div>
<div style="position:absolute;top:248.499;left:452.183;"><nobr>
<span style="font-size:20.022;">NAPOT</span>
</nobr></div>
<div style="position:absolute;top:273.368;left:452.183;"><nobr>
<span style="font-size:20.022;">NAPOT</span>
</nobr></div>
<div style="position:absolute;top:298.235;left:452.183;"><nobr>
<span style="font-size:20.022;">NAPOT</span>
</nobr></div>
<div style="position:absolute;top:323.103;left:475.681;"><nobr>
<span style="font-size:20.022;">...</span>
</nobr></div>
<div style="position:absolute;top:347.970;left:452.183;"><nobr>
<span style="font-size:20.022;">NAPOT</span>
</nobr></div>
<div style="position:absolute;top:372.837;left:452.183;"><nobr>
<span style="font-size:20.022;">NAPOT</span>
</nobr></div>
<div style="position:absolute;top:397.706;left:452.183;"><nobr>
<span style="font-size:20.022;">NAPOT</span>
</nobr></div>
<div style="position:absolute;top:422.573;left:452.183;"><nobr>
<span style="font-size:20.022;">NAPOT</span>
</nobr></div>
<div style="position:absolute;top:198.034;left:553.525;"><nobr>
<span style="font-size:20.022;">Match type and size</span>
</nobr></div>
<div style="position:absolute;top:223.632;left:553.525;"><nobr>
<span style="font-size:20.022;">4-byte NAPOT range</span>
</nobr></div>
<div style="position:absolute;top:248.499;left:553.525;"><nobr>
<span style="font-size:20.022;">8-byte NAPOT range</span>
</nobr></div>
<div style="position:absolute;top:273.368;left:553.525;"><nobr>
<span style="font-size:20.022;">16-byte NAPOT range</span>
</nobr></div>
<div style="position:absolute;top:298.235;left:553.525;"><nobr>
<span style="font-size:20.022;">32-byte NAPOT range</span>
</nobr></div>
<div style="position:absolute;top:323.103;left:670.945;"><nobr>
<span style="font-size:20.022;">...</span>
</nobr></div>
<div style="position:absolute;top:347.970;left:553.525;"><nobr>
<span style="font-size:20.022;">2</span>
<span style="font-size:14.628;font-style:italic;">XLEN</span>
<span style="font-size:20.022;">-byte NAPOT range</span>
</nobr></div>
<div style="position:absolute;top:372.837;left:553.525;"><nobr>
<span style="font-size:20.022;">2</span>
<span style="font-size:14.628;font-style:italic;">XLEN</span>
<span style="font-size:14.628;">+1</span>
<span style="font-size:20.022;">-byte NAPOT range</span>
</nobr></div>
<div style="position:absolute;top:397.706;left:553.525;"><nobr>
<span style="font-size:20.022;">2</span>
<span style="font-size:14.628;font-style:italic;">XLEN</span>
<span style="font-size:14.628;">+2</span>
<span style="font-size:20.022;">-byte NAPOT range</span>
</nobr></div>
<div style="position:absolute;top:422.573;left:553.525;"><nobr>
<span style="font-size:20.022;">2</span>
<span style="font-size:14.628;font-style:italic;">XLEN</span>
<span style="font-size:14.628;">+3</span>
<span style="font-size:20.022;">-byte NAPOT range</span>
</nobr></div>
<div style="position:absolute;top:486.724;left:206.838;"><nobr>
<span style="font-size:20.022;">Table 3.10: NAPOT range encoding in PMP address and configuration registers.</span>
</nobr></div>
<div style="position:absolute;top:532.154;left:132.145;"><nobr>
<span style="font-size:20.022;">If TOR is selected, the associated address register forms the top of the address range, and the</span>
</nobr></div>
<div style="position:absolute;top:557.021;left:132.145;"><nobr>
<span style="font-size:20.022;">preceding PMP address register forms the bottom of the address range. If PMP entry</span>
<span style="font-size:20.022;font-style:italic;">i</span>
<span style="font-size:20.022;">’s A field</span>
</nobr></div>
<div style="position:absolute;top:581.889;left:132.145;"><nobr>
<span style="font-size:20.022;">is set to TOR, the entry matches any address</span>
<span style="font-size:20.022;font-style:italic;">y</span>
<span style="font-size:20.022;">such that pmpaddr</span>
<span style="font-size:14.628;font-style:italic;">i −</span>
<span style="font-size:14.628;">1</span>
<span style="font-size:20.022;font-style:italic;">≤ y &lt;</span>
<span style="font-size:20.022;">pmpaddr</span>
<span style="font-size:14.628;font-style:italic;">i</span>
<span style="font-size:20.022;">. If PMP</span>
</nobr></div>
<div style="position:absolute;top:606.756;left:132.145;"><nobr>
<span style="font-size:20.022;">entry 0’s A field is set to TOR, zero is used for the lower bound, and so it matches any address</span>
</nobr></div>
<div style="position:absolute;top:631.625;left:132.145;"><nobr>
<span style="font-size:20.022;font-style:italic;">y &lt;</span>
<span style="font-size:20.022;">pmpaddr</span>
<span style="font-size:14.628;">0</span>
<span style="font-size:20.022;">.</span>
</nobr></div>
<div style="position:absolute;top:674.776;left:132.145;"><nobr>
<span style="font-size:20.022;">Although the PMP mechanism supports regions as small as four bytes, platforms may specify</span>
</nobr></div>
<div style="position:absolute;top:699.645;left:132.145;"><nobr>
<span style="font-size:20.022;">coarser PMP regions. In general, the PMP grain is 2</span>
<span style="font-size:14.628;font-style:italic;">G</span>
<span style="font-size:14.628;">+2</span>
<span style="font-size:20.022;">bytes and must be the same across all</span>
</nobr></div>
<div style="position:absolute;top:724.512;left:132.145;"><nobr>
<span style="font-size:20.022;">PMP regions. When</span>
<span style="font-size:20.022;font-style:italic;">G ≥</span>
<span style="font-size:20.022;">1, the NA4 mode is not selectable. When</span>
<span style="font-size:20.022;font-style:italic;">G ≥</span>
<span style="font-size:20.022;">2 and pmpcfg</span>
<span style="font-size:14.628;font-style:italic;">i</span>
<span style="font-size:20.022;">.A[1] is set,</span>
</nobr></div>
<div style="position:absolute;top:749.379;left:132.145;"><nobr>
<span style="font-size:20.022;">i.e. the mode is NAPOT, then bits pmpaddr</span>
<span style="font-size:14.628;font-style:italic;">i</span>
<span style="font-size:20.022;">[G-2:0] read as all ones. When</span>
<span style="font-size:20.022;font-style:italic;">G ≥</span>
<span style="font-size:20.022;">1 and pmpcfg</span>
<span style="font-size:14.628;font-style:italic;">i</span>
<span style="font-size:20.022;">.A[1]</span>
</nobr></div>
<div style="position:absolute;top:774.246;left:132.145;"><nobr>
<span style="font-size:20.022;">is clear, i.e. the mode is OFF or TOR, then bits pmpaddr</span>
<span style="font-size:14.628;font-style:italic;">i</span>
<span style="font-size:20.022;">[G-1:0] read as all zeros. Bits pmpaddr</span>
<span style="font-size:14.628;font-style:italic;">i</span>
<span style="font-size:20.022;">[G-</span>
</nobr></div>
<div style="position:absolute;top:799.113;left:132.145;"><nobr>
<span style="font-size:20.022;">1:0] do not affect the TOR address-matching logic. Although changing pmpcfg</span>
<span style="font-size:14.628;font-style:italic;">i</span>
<span style="font-size:20.022;">.A[1] affects the value</span>
</nobr></div>
<div style="position:absolute;top:823.982;left:132.145;"><nobr>
<span style="font-size:20.022;">read from pmpaddr</span>
<span style="font-size:14.628;font-style:italic;">i</span>
<span style="font-size:20.022;">, it does not affect the underlying value stored in that register—in particular,</span>
</nobr></div>
<div style="position:absolute;top:850.511;left:132.145;"><nobr>
<span style="font-size:20.022;">pmpaddr</span>
<span style="font-size:14.628;font-style:italic;">i</span>
<span style="font-size:20.022;">[G-1] retains its original value when pmpcfg</span>
<span style="font-size:14.628;font-style:italic;">i</span>
<span style="font-size:20.022;">.A is changed from NAPOT to TOR/OFF</span>
</nobr></div>
<div style="position:absolute;top:873.717;left:132.145;"><nobr>
<span style="font-size:20.022;">then back to NAPOT.</span>
</nobr></div>
<div style="position:absolute;top:928.467;left:182.201;"><nobr>
<span style="font-size:18.285;font-style:italic;">Software may determine the PMP granularity by writing zero to</span>
<span style="font-size:18.285;">pmp0cfg</span>
<span style="font-size:18.285;font-style:italic;">, then writing all ones</span>
</nobr></div>
<div style="position:absolute;top:950.408;left:182.201;"><nobr>
<span style="font-size:18.285;font-style:italic;">to</span>
<span style="font-size:18.285;">pmpaddr0</span>
<span style="font-size:18.285;font-style:italic;">, then reading back</span>
<span style="font-size:18.285;">pmpaddr0</span>
<span style="font-size:18.285;font-style:italic;">. If G is the index of the least-significant bit set, the</span>
</nobr></div>
<div style="position:absolute;top:972.350;left:182.201;"><nobr>
<span style="font-size:18.285;font-style:italic;">PMP granularity is</span>
<span style="font-size:18.285;">2</span>
<span style="font-size:12.799;font-style:italic;">G</span>
<span style="font-size:12.799;">+2</span>
<span style="font-size:18.285;font-style:italic;">bytes.</span>
</nobr></div>
<div style="position:absolute;top:1005.673;left:132.145;"><nobr>
<span style="font-size:20.022;">If the current XLEN is greater than MXLEN, the PMP address registers are zero-extended from</span>
</nobr></div>
<div style="position:absolute;top:1030.540;left:132.145;"><nobr>
<span style="font-size:20.022;">MXLEN to XLEN bits for the purposes of address matching.</span>
</nobr></div>
<div style="position:absolute;top:1101.060;left:132.145;"><nobr>
<span style="font-size:20.022;font-weight:bold;">Locking and Privilege Mode</span>
</nobr></div>
<div style="position:absolute;top:1157.142;left:132.145;"><nobr>
<span style="font-size:20.022;">The L bit indicates that the PMP entry is locked, i.e., writes to the configuration register and</span>
</nobr></div>
<div style="position:absolute;top:1182.010;left:132.145;"><nobr>
<span style="font-size:20.022;">associated address registers are ignored. Locked PMP entries may only be unlocked with a system</span>
</nobr></div>
<div style="position:absolute;top:1206.877;left:132.145;"><nobr>
<span style="font-size:20.022;">reset. If PMP entry</span>
<span style="font-size:20.022;font-style:italic;">i</span>
<span style="font-size:20.022;">is locked, writes to pmp</span>
<span style="font-size:20.022;font-style:italic;">i</span>
<span style="font-size:20.022;">cfg and pmpaddr</span>
<span style="font-size:20.022;font-style:italic;">i</span>
<span style="font-size:20.022;">are ignored. Additionally, if</span>
</nobr></div>
<div style="position:absolute;top:1233.408;left:132.145;"><nobr>
<span style="font-size:20.022;">pmp</span>
<span style="font-size:20.022;font-style:italic;">i</span>
<span style="font-size:20.022;">cfg .A is set to TOR, writes to pmpaddr</span>
<span style="font-size:20.022;font-style:italic;">i</span>
<span style="font-size:20.022;">-1 are ignored.</span>
</nobr></div>
<div style="position:absolute;top:1274.898;left:132.145;"><nobr>
<span style="font-size:20.022;">In addition to locking the PMP entry, the L bit indicates whether the R/W/X permissions are</span>
</nobr></div>
<div style="position:absolute;top:1299.766;left:132.145;"><nobr>
<span style="font-size:20.022;">enforced on M-mode accesses. When the L bit is set, these permissions are enforced for all privilege</span>
</nobr></div>
</td></tr>
</table>
